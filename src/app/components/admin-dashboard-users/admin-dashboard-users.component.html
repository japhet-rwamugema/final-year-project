<div class="main-content">
  <nav>
    <img src="../../../assets/images/logo.svg" alt="" />
  </nav>
  <div class="main-div">
    <aside>
      <div class="link">
        <a
          routerLink="/dashboard/admin"
          routerLinkActive="active-class"
          [routerLinkActiveOptions]="{ exact: true }"
          >Home</a
        >
        <a
          routerLink="/dashboard/admin/users"
          routerLinkActive="active-class"
          [routerLinkActiveOptions]="{ exact: true }"
          >Users</a
        >
        <a
          routerLink="/dashboard/admin/roles"
          routerLinkActive="active-class"
          [routerLinkActiveOptions]="{ exact: true }"
          >Roles</a
        >
        <a
          routerLink="/dashboard/admin/analytics"
          routerLinkActive="active-class"
          [routerLinkActiveOptions]="{ exact: true }"
          >Analytics</a
        >
      </div>
      <div class="profile">
        <div class="avatar">
          <img src="../../../assets/images/avatar.svg" alt="" />
          <span>Admin</span>
        </div>
        @if (!logoutLoading) {
        <button (click)="logout()">
          Logout <img src="../../../assets/images/logout.svg" alt="" />
        </button>
        }@else {
        <button><app-spinner></app-spinner></button>
        }
      </div>
    </aside>
    <div class="container">
      @if (isLoading) {
      <app-spinner></app-spinner>
      } @if (users && users.data.content.length > 0 || isLoading) {
      <div class="search-container">
        <h1>Employee & their roles</h1>
        <div class="search-actions">
          <button (click)="openCreateUser()">register user</button>
          <button (click)="openCreateInsurance()">create insurance</button>
          <button (click)="openAddImage()">create image type</button>
          <input type="text" placeholder="Search..." [(ngModel)]="searchText" />
        </div>
      </div>
      @if (createInsurance) {
      <app-create-insurance></app-create-insurance>
      } @if (addImage) {
      <app-addimagetype></app-addimagetype>
      } @if (createUser) {
      <app-registeruser></app-registeruser>
      }
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          @if (users) { @for (item of users.data.content | FilterPipe:searchText
          ; track $index) {
          <tr>
            <td>{{ item.firstName }} {{ item.lastName }}</td>
            <td>{{ item.email }}</td>
            <td>{{ item.role }}</td>
            <td>{{ item.status }}</td>
            <td class="actions-container">
              <div class="actions">
                <img src="../../../assets/images/ellipsis.svg" alt="" />
              </div>
              <div class="dropdown">
                <h3>Actions</h3>
                @if (item.status === 'ACTIVE') {
                  @if (!statusLoading) {
                    <button class="dropdown-btn" (click)="changeStatus(item.id)">
                      <img src="../../../assets/images/edit-icon.svg" alt="" /><span
                      >change status</span
                      >
                    </button>
                  }@else {
                    <button><app-spinner></app-spinner></button>
                  }
                }@else if (item.status === 'INACTIVE'){
                  @if (!statusLoading) {
                    <button class="dropdown-btn" (click)="activateStatus(item.id)">
                      <img src="../../../assets/images/edit-icon.svg" alt="" /><span
                      >change status</span
                      >
                    </button>
                  }@else {
                    <button><app-spinner></app-spinner></button>
                  }
                }
                <button class="dropdown-btn" (click)="deleteUser(item.id)">
                  <img
                    src="../../../assets/images/delete-icon.svg"
                    alt=""
                  /><span>Delete</span>
                </button>
              </div>
            </td>
          </tr>
          } }
        </tbody>
      </table>
      }@else {
      <h1 style="color: red">No users found</h1>
      }
    </div>
  </div>
</div>
